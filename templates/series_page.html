{% extends "base.html" %}

{% block body %}


<div class="row">
    <div class="col-md-8">
        <img class="img-responsive series-fanart" src="{{series.fanart}}">
    </div>
     <div class ="col-md-4">
        <h2 class='series-title'>{{series.title}}</h2>
        <p class="series-overview">{{series.overview}}</p>

    </div>

</div>

<hr>

<div class = "row"> 
    
     <div class="user-buttons col-md-6">
        <div class="btn-group" data-toggle="buttons">
          <label class="btn btn-default" id="watching">
            <input type="radio"  value="option1">
            Currently Watching
          </label>
          <label class="btn btn-default" id="watched">
            <input type="radio"  value="option2">
            Watched
          </label>
          <label class="btn btn-default" id="to-watch">
            <input type="radio"  value="option3">
            Want to Watch
          </label>
          <button type="button" class="btn btn-default" id="favorite">Favorite</button>
        </div>
    </div>

    <div class="season-buttons col-md-6">
        <div class="btn-group" data-toggle="buttons">
            {% for i in range(season_dict|length) %}

            <label class="btn btn-default season-button" id="season{{i+1}}">
                <input type="radio"  value="option{{i+1}}">
                {{i+1}}
            </label>

            {% endfor %}
        </div>
         
    </div>

</div>




<div class="row col-md-12">
    <div class="col-md-6"></div>
    <div class="episodes-table col-md-6">
  
        <label id="season-check">
          <input type="checkbox"> Check season as watched
        </label>

        <table class="table table-hover">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Episode Title</th>
                    <th>Watched</th>
                </tr>
            </thead>
            
              
                {% for i in range (season_dict|length) %}
                    <tbody id = "season{{i+1}}-table">
                    {% for e in season_dict[i+1] %}
                    
                        <tr>

                            <td>{{e.ep_num}}</td>
                            <td>{{e.title}}</td>
                            <td>
                                {% if e.id in watched_ep_ids %}
                                    <p class="ep-watched">watched!</p>
                                {% else %}
                                <button type="button" id = "{{e.id}}" class="btn btn-warning watched-button btn-sm">
                                    <span class="glyphicon glyphicon-ok"></span>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                   
                    {% endfor %}
                    </tbody>
                {% endfor %}
             
        </table>

    </div>

</div>




<script type="text/javascript">
    
    function start(){
        $("#seson1").click();
        console.log('start click')
    }
    
    $(document).ready(start);


    $('.btn-group').button()

    if ("{{state}}" == "watching") {
        $("#watching").button('toggle');
    };

    if ("{{state}}" == "watched") {
       $("#watched").button('toggle');
    };

    if ("{{state}}" == "to-watch") {
        $("#to-watch").button('toggle');
    };

    $('#watching').click(update_show_state_to_watching);
    $('#watched').click(update_show_state_to_watched);
    $('#to-watch').click(update_show_state_want_to_watch);
    
    $('#favorite').click(function(e) {
        console.log('link clicked!');
        var seriesId = {{series.id}};
        var userId = {{current_user.id}};
        $.post("/add-fav-series", {series_id:seriesId, user_id:userId});

    });

   

    function change_show_state(state){
        console.log('link clicked!');
        var seriesId = {{series.id}};
        var userId = {{current_user.id}};
        var state = state;
        $.post("/add-user-series", {series_id:seriesId, user_id:userId, state:state});  
    }

    function update_show_state_to_watching(evt){
        change_show_state("watching");
    }

    function update_show_state_to_watched(evt){
        change_show_state("watched");
    }

    function update_show_state_want_to_watch(evt){
        change_show_state("to-watch");
    }

    $('.season-button').click(show_season_episodes);

    function show_season_episodes(evt){
        $("tbody").hide();
        console.log("#"+this.id+"-table");
        $("#"+this.id+"-table").show();
    }

    $('.watched-button').click(function(e) {
        console.log('watched button clicked!');
        var episodeId = this.id;
        console.log(episodeId);
        var userId = {{current_user.id}};
        $.post("/add-watched-episode", {episode_id:episodeId, user_id:userId});

    });

    
   


</script>
{% endblock %}
